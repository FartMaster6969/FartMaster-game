<!DOCTYPE html>
<html>
<head>
  <title>Fart Master</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.2/lib/p5.js"></script>
  <style>
    body { margin: 0; padding: 0; overflow: hidden; }
    canvas { display: block; }
    #restartButton { 
      position: absolute; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, 20px); 
      padding: 10px 20px; 
      font-size: 20px; 
      display: none; 
    }
  </style>
</head>
<body>
  <button id="restartButton" onclick="resetGame()">Starta om</button>
  <script>
    let player;
    let fuels = [];
    let obstacles = [];
    let fuelCount = 0;
    let gameOver = false;
    let highScore = 0;
    let gameStarted = false;
    let fartEffect = 0;

    function setup() {
      createCanvas(windowWidth, windowHeight);
      player = new Player();
      textAlign(CENTER);
      window.focus();
    }

    function draw() {
      background(150, 200, 255);
      fill(100, 200, 100);
      rect(0, height - 100, width, 100);

      if (!gameStarted) {
        textSize(40);
        fill(0);
        text("Tryck MELLANSLAG fÃ¶r att starta!", width / 2, height / 2);
        player.show();
        player.updateStart();
      } else if (!gameOver) {
        player.show();
        player.update();

        if (frameCount % 50 === 0) fuels.push(new Fuel(random(1, 5)));
        if (frameCount % 100 === 0) obstacles.push(new Obstacle());

        for (let i = fuels.length - 1; i >= 0; i--) {
          fuels[i].show();
          fuels[i].update();
          if (player.hits(fuels[i])) {
            fuelCount += fuels[i].value;
            fuels.splice(i, 1);
          }
          if (fuels[i].x < -20) fuels.splice(i, 1);
        }

        for (let i = obstacles.length - 1; i >= 0; i--) {
          obstacles[i].show();
          obstacles[i].update();
          if (player.hits(obstacles[i])) {
            endGame();
          }
          if (obstacles[i].x < -40) obstacles.splice(i, 1);
        }

        fill(0);
        textSize(20);
        text(`Fart Fuel: ${fuelCount}`, 100, 30);
        text(`Highscore: ${highScore}`, width - 100, 30);
      } else {
        // Fis-effekt nÃ¤r du dÃ¶r
        if (fartEffect > 0) {
          textSize(50 + fartEffect);
          fill(139, 69, 19, fartEffect * 5); // Brunaktig fis-fÃ¤rg
          text("ðŸ’¨", width / 2, height / 2 - 50);
          fartEffect--;
        }
        document.getElementById("restartButton").style.display = "block";
      }
    }

    function endGame() {
      gameOver = true;
      let fartScore = calculateFart(fuelCount);
      if (fartScore > highScore) highScore = fartScore;
      textSize(50);
      fill(255, 0, 0);
      text(`BOOM! Fart Score: ${fartScore}`, width / 2, height / 2 - 20);
      fartEffect = map(fuelCount, 0, 50, 10, 30); // StÃ¶rre fis vid mer fuel
    }

    function calculateFart(fuel) {
      if (fuel >= 50) return 10000;
      if (fuel >= 30) return 2000;
      if (fuel >= 15) return 500;
      return 100;
    }

    function keyPressed() {
      if (key === ' ' || keyCode === 32) { // Mellanslag
        if (!gameStarted) {
          gameStarted = true;
        } else if (!gameOver) {
          player.jump();
        }
      }
      if (key === 'r' && gameOver) resetGame();
    }

    function resetGame() {
      gameOver = false;
      gameStarted = false;
      fuelCount = 0;
      fuels = [];
      obstacles = [];
      player = new Player();
      fartEffect = 0;
      document.getElementById("restartButton").style.display = "none";
    }

    class Player {
      constructor() {
        this.x = 100;
        this.y = height - 140;
        this.velocity = 0;
        this.gravity = 0.7;
        this.width = 40;
        this.height = 40;
      }
      show() {
        textSize(40);
        text("ðŸƒ", this.x, this.y + 40); // LÃ¶pare-emoji
      }
      update() {
        this.velocity += this.gravity;
        this.y += this.velocity;
        if (this.y > height - 140) {
          this.y = height - 140;
          this.velocity = 0;
        }
        if (keyIsDown(LEFT_ARROW)) this.x -= 6;
        if (keyIsDown(RIGHT_ARROW)) this.x += 6;
        this.x = constrain(this.x, 0, width - this.width);
      }
      updateStart() {
        this.y = height - 140;
      }
      jump() {
        if (this.y === height - 140) this.velocity = -18;
      }
      hits(obj) {
        let px = this.x;
        let py = this.y;
        let ox = obj.x;
        let oy = obj.y;
        return (px < ox + obj.w && px + this.width > ox && py < oy + obj.h && py + this.height > oy);
      }
    }

    class Fuel {
      constructor(value) {
        this.x = width;
        this.y = random(height - 250, height - 140);
        this.value = value;
        this.w = 25;
        this.h = 25;
      }
      show() {
        textSize(25);
        if (this.value <= 2) text("ðŸŒ®", this.x, this.y + 25); // Taco fÃ¶r lÃ¥g fuel
        else if (this.value <= 4) text("ðŸ¥¬", this.x, this.y + 25); // KÃ¥l fÃ¶r medel
        else text("ðŸŒ¶ï¸", this.x, this.y + 25); // Chili fÃ¶r hÃ¶g fuel
      }
      update() {
        this.x -= 5;
      }
    }

    class Obstacle {
      constructor() {
        this.x = width;
        this.y = height - 140;
        this.w = 50;
        this.h = 50;
      }
      show() {
        textSize(50);
        text("ðŸš½", this.x, this.y + 50); // Toalett som hinder
      }
      update() {
        this.x -= 5;
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }
  </script>
</body>
</html>