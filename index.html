<!DOCTYPE html>
<html>
<head>
  <title>Fart Master</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.2/lib/p5.js"></script>
</head>
<body>
  <script>
    let player;
    let fuels = [];
    let obstacles = [];
    let fuelCount = 0;
    let gameOver = false;

    function setup() {
      createCanvas(800, 400);
      player = new Player();
    }

    function draw() {
      background(200);
      
      if (!gameOver) {
        player.show();
        player.update();

        if (frameCount % 60 === 0) fuels.push(new Fuel());
        if (frameCount % 120 === 0) obstacles.push(new Obstacle());

        for (let i = fuels.length - 1; i >= 0; i--) {
          fuels[i].show();
          if (player.hits(fuels[i])) {
            fuelCount += fuels[i].value;
            fuels.splice(i, 1);
          }
        }

        for (let i = obstacles.length - 1; i >= 0; i--) {
          obstacles[i].show();
          obstacles[i].update();
          if (player.hits(obstacles[i])) {
            endGame();
          }
        }
      }
    }

    function endGame() {
      gameOver = true;
      let fartScore = calculateFart(fuelCount);
      textSize(32);
      textAlign(CENTER);
      text(`Fart Score: ${fartScore}`, width / 2, height / 2);
    }

    function calculateFart(fuel) {
      if (fuel > 60) return 10000;
      if (fuel > 30) return 2000;
      if (fuel > 10) return 500;
      return 100;
    }

    function keyPressed() {
      if (keyCode === UP_ARROW) player.jump();
    }

    class Player {
      constructor() {
        this.x = 100;
        this.y = height - 50;
        this.velocity = 0;
        this.gravity = 0.6;
      }
      show() {
        fill(255, 0, 0);
        rect(this.x, this.y, 30, 30);
      }
      update() {
        this.velocity += this.gravity;
        this.y += this.velocity;
        if (this.y > height - 50) this.y = height - 50, this.velocity = 0;
        if (keyIsDown(LEFT_ARROW)) this.x -= 5;
        if (keyIsDown(RIGHT_ARROW)) this.x += 5;
      }
      jump() {
        if (this.y === height - 50) this.velocity = -12;
      }
      hits(obj) {
        return collideRectRect(this.x, this.y, 30, 30, obj.x, obj.y, obj.w, obj.h);
      }
    }

    class Fuel {
      constructor() {
        this.x = width;
        this.y = random(height - 100);
        this.value = 1;
        this.w = 20;
        this.h = 20;
      }
      show() {
        fill(0, 255, 0);
        rect(this.x, this.y, this.w, this.h);
        this.x -= 3;
      }
    }

    class Obstacle {
      constructor() {
        this.x = width;
        this.y = height - 50;
        this.w = 40;
        this.h = 40;
      }
      show() {
        fill(0, 0, 255);
        rect(this.x, this.y, this.w, this.h);
      }
      update() {
        this.x -= 3;
      }
    }
  </script>
</body>
</html>