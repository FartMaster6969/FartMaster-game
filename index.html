<!DOCTYPE html>
<html>
<head>
  <title>Fart Master</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.2/lib/p5.js"></script>
  <style>
    body { margin: 0; padding: 0; overflow: hidden; }
    canvas { display: block; }
    #restartButton { 
      position: absolute; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, 60px); 
      padding: 10px 20px; 
      font-size: 20px; 
      display: none; 
    }
  </style>
</head>
<body>
  <button id="restartButton" onclick="resetGame()">Restart</button>
  <script>
    let player;
    let fuels = [];
    let obstacles = [];
    let farts = [];
    let fuelCount = 0;
    let gameOver = false;
    let highScore = 0;
    let gameStarted = false;
    let fartScene = false;
    let fartEffect = 0;
    let fartScore = 0;
    let rank = "Fart Newbie";
    let highestRank = "Fart Newbie";

    function setup() {
      createCanvas(windowWidth, windowHeight);
      player = new Player(getCharIdFromRank(highestRank));
      textAlign(CENTER);
      window.focus();
      for (let i = 0; i < 10; i++) {
        farts.push(new BackgroundFart());
      }
    }

    function draw() {
      background(150, 200, 255);
      fill(100, 200, 100);
      rect(0, height - 100, width, 100);

      for (let fart of farts) {
        fart.show();
        fart.update();
      }

      if (!gameStarted) {
        textSize(40);
        fill(0);
        text("Fart Master", width / 2, height / 2 - 150);
        textSize(30);
        text("Press SPACE to start!", width / 2, height / 2 - 100);
        textSize(20);
        text("Fart Fuel Sources:", width / 2, height / 2 - 50);
        text("ðŸŒ® Taco: 1-2 Fuel", width / 2, height / 2 - 20);
        text("ðŸ¥¬ Cabbage: 3-4 Fuel", width / 2, height / 2 + 10);
        text("ðŸŒ¶ï¸ Chili: 5 Fuel", width / 2, height / 2 + 40);
        text("Ranks:", width / 2, height / 2 + 80);
        text("Fart Newbie: 0-1499", width / 2, height / 2 + 110);
        text("Gas Pro: 1500-4999", width / 2, height / 2 + 140);
        text("Fart Master: 5000-9999", width / 2, height / 2 + 170);
        text("Super Fart Legend: 10000+", width / 2, height / 2 + 200);
        player.show();
        player.updateStart();
      } else if (!gameOver) {
        player.show();
        player.update();

        if (player.jumpFart > 0) {
          push();
          translate(player.x - 20, player.y + 40);
          scale(-1, 1);
          textSize(20 + player.jumpFart * 2);
          fill(0, 255, 0, player.jumpFart * 20);
          text("ðŸ’¨", 0, 0);
          pop();
          player.jumpFart--;
        }

        if (frameCount % 50 === 0) fuels.push(new Fuel(random(1, 5)));
        if (frameCount % 100 === 0) {
          obstacles.push(new Obstacle(random(1) > 0.5));
        }

        for (let i = fuels.length - 1; i >= 0; i--) {
          fuels[i].show();
          fuels[i].update();
          if (player.hits(fuels[i])) {
            fuelCount += fuels[i].value;
            fuels.splice(i, 1);
          }
          if (fuels[i].x < -20) fuels.splice(i, 1);
        }

        for (let i = obstacles.length - 1; i >= 0; i--) {
          obstacles[i].show();
          obstacles[i].update();
          if (player.hits(obstacles[i])) {
            endGame();
          }
          if (obstacles[i].x < -obstacles[i].w) obstacles.splice(i, 1);
        }

        fill(0);
        textSize(20);
        text(`Fart Fuel: ${fuelCount}`, 100, 30);
        text(`Highscore: ${highScore}`, width - 100, 30);
        text(`Rank: ${highestRank}`, width / 2, 30);
      } else if (fartScene) {
        player.showDead();
        if (fartEffect > 0) {
          push();
          textSize(50 + fartEffect * 3);
          fill(0, 255, 0, fartEffect * 3);
          text("ðŸ’¨", player.x + 50, player.y - fartEffect * 5);
          pop();
          fartScore = Math.floor((60 - fartEffect) * fuelCount * 0.5);
          if (fartScore < 0) fartScore = 0;
          fill(0);
          textSize(30);
          text(`Fart Score: ${fartScore}`, width / 2, height / 2 + 20);
          if (frameCount % 3 === 0) fartEffect--;
          if (fartEffect <= 0) {
            fartScene = false;
            updateRank();
            if (fartScore > highScore) highScore = fartScore;
          }
        }
      } else {
        textSize(50);
        fill(255, 0, 0);
        text(`BOOM! Fart Score: ${fartScore}`, width / 2, height / 2 - 20);
        textSize(30);
        fill(0);
        text(`Rank: ${highestRank}`, width / 2, height / 2 + 20);
        document.getElementById("restartButton").style.display = "block";
      }
    }

    function endGame() {
      gameOver = true;
      fartScene = true;
      fartEffect = map(fuelCount, 0, 50, 20, 60);
      fartScore = 0;
    }

    function updateRank() {
      if (fartScore >= 10000) highestRank = "Super Fart Legend";
      else if (fartScore >= 5000 && highestRank != "Super Fart Legend") highestRank = "Fart Master";
      else if (fartScore >= 1500 && highestRank != "Super Fart Legend" && highestRank != "Fart Master") highestRank = "Gas Pro";
      else if (highestRank == "Fart Newbie") highestRank = "Fart Newbie";
    }

    function getCharIdFromRank(rank) {
      if (rank === "Super Fart Legend") return 3;
      if (rank === "Fart Master") return 2;
      if (rank === "Gas Pro") return 1;
      return 0;
    }

    function keyPressed() {
      if (key === ' ' || keyCode === 32) {
        if (!gameStarted) {
          gameStarted = true;
        } else if (!gameOver) {
          player.jump();
        }
      }
      if (key === 'r' && gameOver && !fartScene) resetGame();
    }

    function resetGame() {
      gameOver = false;
      gameStarted = false;
      fuelCount = 0;
      fuels = [];
      obstacles = [];
      player = new Player(getCharIdFromRank(highestRank));
      fartScene = false;
      fartEffect = 0;
      fartScore = 0;
      document.getElementById("restartButton").style.display = "none";
    }

    class Player {
      constructor(charId) {
        this.x = 100;
        this.y = height - 140;
        this.velocity = 0;
        this.gravity = 0.7;
        this.width = 40;
        this.height = 50;
        this.jumpsLeft = 2;
        this.charId = charId;
        this.legAngle = 0;
        this.armAngle = 0;
        this.jumpFart = 0;
      }
      show() {
        push();
        translate(this.x, this.y);
        if (this.charId === 0) { // Gasbag Gubbe
          // Kropp
          fill(255, 200, 150);
          ellipse(20, 30, 30, 40);
          // Huvud
          ellipse(20, 10, 20, 20);
          // Ã–gon
          fill(255);
          ellipse(15, 8, 6, 6); ellipse(25, 8, 6, 6);
          fill(0);
          ellipse(15, 8, 3, 3); ellipse(25, 8, 3, 3);
          // Armar
          stroke(255, 200, 150);
          strokeWeight(4);
          line(10, 25, 5 + sin(this.armAngle) * 5, 35);
          line(30, 25, 35 - sin(this.armAngle) * 5, 35);
          noStroke();
          // Ben
          stroke(255, 200, 150);
          strokeWeight(4);
          line(15, 50, 15 + sin(this.legAngle) * 5, 60);
          line(25, 50, 25 - sin(this.legAngle) * 5, 60);
          noStroke();
        } else if (this.charId === 1) { // Turbo Tarm
          // Kropp (slingrig tarm)
          noFill();
          stroke(255, 150, 150);
          strokeWeight(10);
          beginShape();
          for (let i = 0; i < 6; i++) curveVertex(20 + sin(i * 0.5 + this.legAngle) * 10, 5 + i * 10);
          endShape();
          noStroke();
          // Ã–gon lÃ¤ngst upp
          fill(255);
          ellipse(15, 5, 6, 6); ellipse(25, 5, 6, 6);
          fill(0);
          ellipse(15, 5, 3, 3); ellipse(25, 5, 3, 3);
          // SmÃ¥ "fÃ¶tter"
          fill(255, 150, 150);
          ellipse(15 + sin(this.legAngle) * 5, 55, 8, 8);
          ellipse(25 - sin(this.legAngle) * 5, 55, 8, 8);
        } else if (this.charId === 2) { // Farting Flamingo
          // Kropp
          fill(255, 150, 200);
          ellipse(20, 30, 20, 40);
          // Huvud och nÃ¤bb
          ellipse(20, 10, 15, 15);
          stroke(255, 100, 150);
          strokeWeight(3);
          line(20, 10, 30, 15);
          noStroke();
          // Ã–ga
          fill(0);
          ellipse(17, 8, 4, 4);
          // Vinge
          fill(255, 150, 200);
          ellipse(10, 30, 15, 25 + sin(this.armAngle) * 5);
          // Ben
          stroke(255, 100, 150);
          strokeWeight(4);
          line(20, 50, 20 + sin(this.legAngle) * 10, 65);
          noStroke();
          this.legAngle += 0.2;
          this.armAngle += 0.1;
        } else if (this.charId === 3) { // Prutt-Piraten
          // Kropp
          fill(150, 100, 50);
          rect(10, 20, 20, 30, 5);
          // Huvud
          fill(255, 200, 150);
          ellipse(20, 10, 20, 20);
          // Ã–gon och Ã¶gonlapp
          fill(0);
          ellipse(25, 8, 6, 6);
          rect(15, 6, 10, 6);
          // Hatt
          fill(0);
          triangle(10, 5, 20, 0, 30, 5);
          // Armar
          stroke(150, 100, 50);
          strokeWeight(4);
          line(10, 25, 5 + sin(this.armAngle) * 5, 35);
          line(30, 25, 35 - sin(this.armAngle) * 5, 35);
          noStroke();
          // Ben
          stroke(100);
          strokeWeight(4);
          line(15, 50, 15, 60); // TrÃ¤ben
          stroke(150, 100, 50);
          line(25, 50, 25 + sin(this.legAngle) * 5, 60);
          noStroke();
          this.armAngle += 0.1;
        }
        pop();
        if (this.velocity === 0) this.legAngle += 0.2; // Snabbare pÃ¥ marken
      }
      showDead() {
        push();
        translate(this.x, this.y);
        if (this.charId === 0) {
          fill(200, 150, 100);
          ellipse(20, 30, 30, 40);
          ellipse(20, 10, 20, 20);
          fill(255);
          ellipse(15, 8, 6, 6); ellipse(25, 8, 6, 6);
          fill(0);
          ellipse(15, 8, 2, 2); ellipse(25, 8, 2, 2);
          stroke(200, 150, 100);
          strokeWeight(4);
          line(15, 50, 15, 60);
          line(25, 50, 25, 60);
          noStroke();
        } else if (this.charId === 1) {
          noFill();
          stroke(200, 100, 100);
          strokeWeight(10);
          beginShape();
          for (let i = 0; i < 6; i++) curveVertex(20, 5 + i * 10);
          endShape();
          noStroke();
          fill(255);
          ellipse(15, 5, 6, 6); ellipse(25, 5, 6, 6);
          fill(0);
          ellipse(15, 5, 2, 2); ellipse(25, 5, 2, 2);
          fill(200, 100, 100);
          ellipse(15, 55, 8, 8); ellipse(25, 55, 8, 8);
        } else if (this.charId === 2) {
          fill(200, 100, 150);
          ellipse(20, 30, 20, 40);
          ellipse(20, 10, 15, 15);
          stroke(200, 80, 120);
          strokeWeight(3);
          line(20, 10, 30, 15);
          noStroke();
          fill(0);
          ellipse(17, 8, 2, 2);
          fill(200, 100, 150);
          ellipse(10, 30, 15, 25);
          stroke(200, 80, 120);
          strokeWeight(4);
          line(20, 50, 15, 65); line(20, 50, 25, 65);
          noStroke();
        } else if (this.charId === 3) {
          fill(100, 70, 30);
          rect(10, 20, 20, 30, 5);
          fill(200, 150, 100);
          ellipse(20, 10, 20, 20);
          fill(0);
          ellipse(25, 8, 4, 4);
          rect(15, 6, 10, 6);
          fill(50);
          triangle(10, 5, 20, 0, 30, 5);
          stroke(100, 70, 30);
          strokeWeight(4);
          line(10, 25, 5, 35);
          line(30, 25, 35, 35);
          noStroke();
          stroke(80);
          strokeWeight(4);
          line(15, 50, 15, 60);
          stroke(100, 70, 30);
          line(25, 50, 25, 60);
          noStroke();
        }
        pop();
      }
      update() {
        this.velocity += this.gravity;
        this.y += this.velocity;
        if (this.y > height - 140) {
          this.y = height - 140;
          this.velocity = 0;
          this.jumpsLeft = 2;
        }
        if (keyIsDown(LEFT_ARROW)) this.x -= 6;
        if (keyIsDown(RIGHT_ARROW)) this.x += 6;
        this.x = constrain(this.x, 0, width - this.width);
      }
      updateStart() {
        this.y = height - 140;
      }
      jump() {
        if (this.jumpsLeft > 0) {
          this.velocity = -12;
          this.jumpsLeft--;
          this.jumpFart = 10;
        }
      }
      hits(obj) {
        let px = this.x;
        let py = this.y;
        let ox = obj.x;
        let oy = obj.y;
        return (px < ox + obj.w && px + this.width > ox && py < oy + obj.h && py + this.height > oy);
      }
    }

    class Fuel {
      constructor(value) {
        this.x = width;
        this.y = random(height - 250, height - 140);
        this.value = value;
        this.w = 25;
        this.h = 25;
      }
      show() {
        push();
        textSize(25);
        fill(0);
        if (this.value <= 2) text("ðŸŒ®", this.x, this.y + 25);
        else if (this.value <= 4) text("ðŸ¥¬", this.x, this.y + 25);
        else text("ðŸŒ¶ï¸", this.x, this.y + 25);
        pop();
      }
      update() {
        this.x -= 5;
      }
    }

    class Obstacle {
      constructor(isBig) {
        this.x = width;
        this.y = height - (isBig ? 190 : 140);
        this.w = isBig ? 60 : 50;
        this.h = isBig ? 100 : 50;
        this.isBig = isBig;
      }
      show() {
        push();
        textSize(this.h);
        fill(0);
        text("ðŸš½", this.x, this.y + this.h);
        pop();
      }
      update() {
        this.x -= 5;
      }
    }

    class BackgroundFart {
      constructor() {
        this.x = random(width);
        this.y = random(height - 300);
        this.speed = random(1, 3);
        this.size = random(20, 40);
      }
      show() {
        push();
        textSize(this.size);
        fill(0, 255, 0, 50);
        text("ðŸ’¨", this.x, this.y);
        pop();
      }
      update() {
        this.x -= this.speed;
        if (this.x < -this.size) {
          this.x = width + this.size;
          this.y = random(height - 300);
          this.speed = random(1, 3);
        }
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }
  </script>
</body>
</html>